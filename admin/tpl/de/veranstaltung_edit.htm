<link href="{uri_baseurl(/js/tree/skin/ui.dynatree.css)}" rel="stylesheet" type="text/css">
<script src="{uri_baseurl(/js/tree/jquery.dynatree.min.js)}" type="text/javascript"></script>
<script type="text/javascript" src="{uri_resource(/js/ajaxfileupload.js)}"></script>
<script type="text/javascript" src="{uri_resource(/js/marktplatz-ad-create.js)}"></script>
<script type="text/javascript" src="{uri_baseurl(/tinymce/jscripts/tiny_mce/tiny_mce.js)}"></script>

<script type="text/javascript">

	function reloadCalenderEventImage() {
		var formular = jQuery("#form_calendar_events");

		// Start ajax upload
		jQuery.ajax({
			url: 'index.php?page=veranstaltung_edit&id={ID_CALENDAR_EVENT}&DO=fetch_images',
			data: formular.serialize(),
			type: 'post',
			success: function(response) {
				jQuery("#list_images").html(response);
			}
		});
	}

	function deleteCalendarEventImage(imageId) {
		var formular = jQuery("#form_calendar_events");

		// Start ajax upload
		jQuery.ajax({
			url: 'index.php?page=veranstaltung_edit&id={ID_CALENDAR_EVENT}&DO=delete_image&ID_IMAGE='+imageId,
			data: formular.serialize(),
			type: 'post',
			success: function(response) {
				reloadCalenderEventImage();
			}
		});
	}

	function reloadCalenderEventVideo() {
		var formular = jQuery("#form_calendar_events");

		// Start ajax upload
		jQuery.ajax({
			url: 'index.php?page=veranstaltung_edit&id={ID_CALENDAR_EVENT}&DO=fetch_videos',
			data: formular.serialize(),
			type: 'post',
			success: function(response) {
				jQuery("#list_videos").html(response);
			}
		});
	}

	function deleteCalendarEventVideo(videoId) {
		var formular = jQuery("#form_calendar_events");

		// Start ajax upload
		jQuery.ajax({
			url: 'index.php?page=veranstaltung_edit&id={ID_CALENDAR_EVENT}&DO=delete_video&ID_VIDEO='+videoId,
			data: formular.serialize(),
			type: 'post',
			success: function(response) {
				reloadCalenderEventVideo();
			}
		});
	}

	function reloadCalendarEventSearchWordList(el, lang) {
		jQuery.ajax({
		    url: 'index.php?page=veranstaltung_edit&id={ID_CALENDAR_EVENT}',
		    data: {
		    	'DO': 'fetch_searchwords',
		    	'LANG': lang
		    },
		    type: 'POST',
	        success: function(result) {
	            jQuery(el).html(result);
	        }
	   });
	}

	function addCalendarEventSearchword(lang) {
		var formular = jQuery("#calendarEventSearchWordFormular"+lang);
		var word = formular.find("input[name=SEARCHWORD]").val();
		jQuery.post('index.php?page=veranstaltung_edit&id={ID_CALENDAR_EVENT}', {
			'DO': 'add_searchword',
			'WORD': word,
			'LANG': lang
		}, function(result) {
			jQuery(formular).find("input[name=SEARCHWORD]").val('');
			reloadCalendarEventSearchWordList('#calendarEventSearchList' + lang, lang);
		});
		return false;
	}

	function remCalendarEventSearchword(button, lang) {
		var word = jQuery(button).attr('rel');

		if(confirm("Möchten Sie das Schlagwort " + word + " wirklich löschen?")) {
			jQuery.ajax({
				url: 'index.php?page=veranstaltung_edit&id={ID_CALENDAR_EVENT}',
				data: {
					'DO': 'del_searchword',
					'SEARCHWORD': word,
					'LANG': lang
				},
				dataType: 'json',
				type: 'POST',
				success: function(result) {
					reloadCalendarEventSearchWordList('#calendarEventSearchList' + lang, lang);
				}
			})
		}
		return false;
	}

	jQuery(function() {



		var categoryTree = {CATEGORY_JSON_TREE};
		var categoryTreeMaxSelects = 1;


		tree = jQuery("#calendarEventCategoryTree").dynatree({
			checkbox: true,
			classNames: {checkbox: "dynatree-radio"},
			selectMode: 1,

			autoCollapse: true,
			debugLevel: 0,
			children: categoryTree,
			onSelect: function(select, node) {
				jQuery("#form_calendar_events [name=FK_KAT]").val(node.data.key);
			}
		});

		jQuery("input[name=STAMP_START_DATE]").datepicker({
			dateFormat: 'dd.mm.yy',
			{if STAMP_START_DATE}maxDate: '{STAMP_END_DATE}',{endif}
			numberOfMonths: 3,
			onClose: function(dateStart) {
				jQuery("input[name=STAMP_END_DATE]").datepicker("option", "minDate", dateStart);
			}
		});
		jQuery("input[name=STAMP_END_DATE]").datepicker({
			dateFormat: 'dd.mm.yy',
			{if STAMP_START_DATE}minDate: '{STAMP_START_DATE}',{endif}
			numberOfMonths: 3,
			onClose: function(dateEnd) {
				jQuery("input[name=STAMP_START_DATE]").datepicker("option", "maxDate", dateEnd);
			}
		});

		InitializeEditor(true, "DESCRIPTION_EDITOR");

    	jQuery("#calendarEventFormularSearchWordTab").tabs();
	});
</script>

<h1>
	Veranstaltung '{htm(TITLE)}' bearbeiten
</h1>
{if SAVED}
<h3 class="ok">
	Änderung erfolgreich gespeichert!
</h3>
{endif}

<a name="form_top"></a>
<form id="form_calendar_events" action="index.php?page=veranstaltung_edit&id={ID_CALENDAR_EVENT}" method="post" enctype="multipart/form-data" class="form-horizontal">
	<input type="hidden" name="frame" value="popup" />
	<input type="hidden" name="page" value="veranstaltung_edit" />
	<input type="hidden" name="id" value="{ID_CALENDAR_EVENT}" />
	<input type="hidden" name="ID_CALENDAR_EVENT" value="{ID_CALENDAR_EVENT}" />
	<input type="hidden" name="FK_KAT" value="{FK_KAT}" />
	<input type="hidden" name="DESCRIPTION" value="{DESCRIPTION}" />

	<div>
		<legend style="font-size: 15px; font-weight: bold;">
			Typ der Veranstaltung
		</legend>
		<p>
			Bitte wählen Sie, ob Sie eine Firmenveranstaltung oder eine Gruppenveranstaltung veröffentlichen möchten.
		</p>

		<label class="radio">
			<input name="FK_REF_TYPE" type="radio" required="required" onchange="updateCalendarEventRefTyp()" value="user" {if FK_REF_TYPE_USER}checked="checked"{endif}>

			<strong>Firmenveranstaltung</strong>
			<br>
			Die Veranstaltung wird im Namen Ihrer Firma und innerhalb Ihres Anbieterprofils veröffentlicht.
		</label>
		<br />

		<label class="radio">
			<input name="FK_REF_TYPE" type="radio" required="required" onchange="updateCalendarEventRefTyp()" value="club" {if FK_REF_TYPE_CLUB}checked="checked"{endif} {if !liste_clubs}disabled="disabled"{endif}>

			<strong>Gruppenveranstaltung</strong>
			<br>
			Die Veranstaltung wird in einer Ihrer Gruppen veröffentlicht.
		</label>

		{if liste_clubs}
		<div class="control-group" id="calendarEventRefTypeCalendarEventContainer">
			<label class="control-label"><strong>Gruppe:</strong></label>
			<div class="controls">
				<select name="FK_REF">
					{liste_clubs}
				</select>
			</div>
		</div>
		{endif}
	</div>
	<br />

	<div>
		<legend style="font-size: 15px; font-weight: bold;">
			Kategorie
		</legend>
		<p>
			Wählen Sie in diesem Schritt eine Kategorie, in der Ihre Veranstaltung zu finden sein soll.
		</p>
		<p id="step_kat_error_default" class="alert alert-error" style="display: none;">
			Sie müssen eine Kategorie auswählen um fortzufahren.
		</p>

		<div>
			<div id="calendarEventCategoryTree" style="overflow: auto; max-height: 400px;"></div>
		</div>
	</div>
	<br />

	<div>
		<legend style="font-size: 15px; font-weight: bold;">
			Beschreibung
		</legend>

		<div class="control-group">
			<label class="control-label"><strong>Titel der Veranstaltung *:</strong></label>
			<div id="CONTROLS_TITLE" class="controls">
				<input type="text" name="TITLE" required="required" class="" value="{TITLE}">
				<span class="help-inline alert alert-error" style="display: none;">
					Bitte geben Sie einen Titel ein.
				</span>
			</div>
		</div>

		<div class="control-group">
			<label class="control-label"><strong>von *:</strong></label>
			<div id="CONTROLS_STAMP_START" class="controls">
				<input type="text" name="STAMP_START_DATE" required="required" class="input-small input-date" value="{STAMP_START_DATE}">
				<input type="time" name="STAMP_START_TIME" required="required" class="input-small" value="{STAMP_START_TIME}" placeholder="12:00">
				<span class="help-inline alert alert-error" style="display: none;">
					Bitte geben Sie ein gültiges Startdatum ein.
				</span>
			</div>
		</div>

		<div class="control-group">
			<label class="control-label"><strong>bis *:</strong></label>
			<div id="CONTROLS_STAMP_END" class="controls">
				<input type="text" name="STAMP_END_DATE" required="required" class="input-small input-date" value="{STAMP_END_DATE}">
				<input type="time" name="STAMP_END_TIME" required="required" class="input-small" value="{STAMP_END_TIME}" placeholder="12:00">
				<span class="help-inline alert alert-error" style="display: none;" data-ident="INVALID">
					Bitte geben Sie ein gültiges Enddatum ein.
				</span>
				<span class="help-inline alert alert-error" style="display: none;" data-ident="START_BEFORE_END">
					Das Startdatum muss vor dem Enddatum liegen.
				</span>
			</div>
		</div>

        <div class="control-group">
            <label class="control-label"><strong>Veranstaltungsort:</strong></label>
            <div id="CONTROLS_LOCATION" class="controls">
                <input type="text" name="LOCATION" class="" value="{LOCATION}">
            </div>
        </div>

        <div class="control-group">
            <label class="control-label"><strong>Straße:</strong></label>
            <div id="CONTROLS_STREET" class="controls">
                <input type="text" name="STREET" class="" value="{STREET}">
            </div>
        </div>

		<div class="control-group">
			<label class="control-label"><strong>PLZ / Ort:</strong></label>
			<div id="CONTROLS_ZIP_CITY" class="controls">
				<input type="text" name="ZIP" class="input-mini" value="{ZIP}">
				<input type="text" name="CITY" class="" value="{CITY}">
			</div>
		</div>

		<div class="control-group">
			<label class="control-label"><strong>Land:</strong></label>
			<div id="CONTROLS_FK_COUNTRY" class="controls">
				{select(country,,,,, onchange="" id="COUNTRY",----)}
				<span class="help-inline">
					<span class="alert alert-error hidden">
						Der angegebene Standort wurde nicht gefunden. Bitte ergänzen/korrigieren
						Sie ihre Eingaben.
					</span>
				</span>
			</div>
		</div>

		<div class="control-group onlyVisibleToGroups">
			<label class="control-label"><strong>Privatsphäre:</strong></label>
			<div id="CONTROLS_PRIVACY" class="controls">
				<label class="radio"><input type="radio" name="PRIVACY" value="0" {if PRIVACY == 0}checked="checked"{endif}> Nur für Gruppenmitglieder sichtbar</label>
				<label class="radio"><input type="radio" name="PRIVACY" value="1" {if PRIVACY == 1}checked="checked"{endif}> Öffentlich sichtbar</label>
			</div>
		</div>

		<div class="control-group">
			<label class="control-label"><strong>Kommentare:</strong></label>
			<div id="CONTROLS_ALLOW_COMMENTS" class="controls">
				<label class="checkbox">
					<input type="checkbox" name="ALLOW_COMMENTS" value="1" {if ALLOW_COMMENTS}checked="checked"{endif}>
					Kommentare zu dieser Veranstaltung erlauben
				</label>
			</div>
		</div>

		<div class="control-group">
			<label class="control-label"><strong>Schlagworte:</strong></label>
			<div id="CONTROLS_SEARCHWORD" class="controls">
				<div id="calendarEventFormularSearchWordTab">
					<ul>
						{searchWordLanguageHeader}
					</ul>
					<div>
						{searchWordLanguageBody}
					</div>
				</div>
			</div>
		</div>

		<div class="control-group">
			<label class="control-label"><strong>Beschreibung *:</strong></label>
			<div id="CONTROLS_DESCRIPTION" class="controls">

				<textarea style="width: 100%; height: 100px" name="DESCRIPTION_EDITOR" id="DESCRIPTION_EDITOR">{htm(DESCRIPTION)}</textarea>
				<br />
				<span class="alert alert-error hidden">
					Bitte geben Sie eine Beschreibung ein.
				</span>
			</div>
		</div>

	</div>
	<br />

	<div>
		<legend style="font-size: 15px; font-weight: bold;">
			Bilder und Videos
		</legend>

		<div>
			<!-- Bilder -->
			<div id="list_images" class="clearfix">
			{if !liste_images}
				<p class="error">
					Es wurden noch keine Bilder hochgeladen.
				</p>
			{else}
				{liste_images}
			{endif}
			</div>
		</div>
		<br />

		<div>
			<!-- Videos -->
			<div id="list_videos" class="clearfix">
			{if !liste_videos}
				<p class="error">
					Es wurden noch keine Videos hochgeladen.
				</p>
			{else}
				{liste_videos}
			{endif}
			</div>
		</div>
	</div>
	<div align="right">
		<input type="submit" value="Speichern" />
	</div>
</form>