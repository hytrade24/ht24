<script>
function CalendarEventDelete(id_calendar_event, name) {
	if (!confirm("Möchten Sie die Veranstaltung '"+name+"' wirklich unwiderruflich löschen?")) {
		return;
	}
	jQuery.get("index.php?page=veranstaltung&ajax=delete&id="+id_calendar_event, function(result) {
		if (!result.success) {
			alert("Fehler beim löschen der Veranstaltung!");
		}
		jQuery("#form_search").submit();
	});
}

function CalendarEventEdit(id) {
    popupfkt('veranstaltung_edit&id='+id, 800, 600);
    return false;
}

function initEditor(id, width, height) {
	tinyMCE.init({
		// General options
		mode : "none",
		elements : id,
		theme : "advanced",
		width: width,
		height: height,
		language: "de",
		object_resizing : false,
		convert_fonts_to_spans : true,
		convert_urls : false,
		document_base_url : "/",
		relative_urls : false,
		remove_script_host : true,
		forced_root_block: false,
		verify_html : false,
		verify_css_classes : false,
		plugins : "safari,pagebreak,style,layer,table,save,advhr,advimage,advlink,emotions,iespell,inlinepopups,insertdatetime,preview,media,searchreplace,print,contextmenu,paste,directionality,fullscreen,noneditable,visualchars,nonbreaking,xhtmlxtras,template",

		// Theme options
		theme_advanced_buttons1 : "code,save,|,bold,italic,underline,strikethrough,|,justifyleft,justifycenter,justifyright,justifyfull,styleselect,formatselect,fontselect,fontsizeselect",
		theme_advanced_buttons2 : "cut,copy,paste,pastetext,pasteword,|,search,replace,|,bullist,numlist,|,outdent,indent,blockquote,|,undo,redo,|,link,unlink,anchor,image,cleanup,|,insertdate,inserttime,preview,|,forecolor,backcolor",
		theme_advanced_buttons3 : "tablecontrols,|,hr,removeformat,visualaid,|,sub,sup,|,charmap,emotions,media,advhr,|,ltr,rtl,|,fullscreen",
		theme_advanced_buttons4 : "insertlayer,moveforward,movebackward,absolute,|,styleprops,|,cite,abbr,acronym,del,ins,attribs,|,visualchars,nonbreaking",
		theme_advanced_toolbar_location : "top",
		theme_advanced_toolbar_align : "left",
		theme_advanced_statusbar_location : "bottom",
		theme_advanced_resizing : true,

		// Example content CSS (should be your site CSS)
		content_css : "/skin/style.css"
	});
	tinyMCE.execCommand('mceRemoveControl', false, id);
	tinyMCE.execCommand("mceAddControl", true, id);
}

function ShowPage(page) {
    var form = jQuery("#form_search");
    form.find("input[name=npage]").val(page);
    form.submit();
}

function ReloadPage() {
    jQuery("#form_search").submit();
}

function UnlockSuccess() {
    document.location.href = "{uri_baseurl(/admin/)}index.php?page={curpage}&search={SEARCH_HASH}&npage={npage}&done=unlock";
}

function UnlockAccept(id_event, title, id_user, name) {
    jQuery("#modalEventAccept").each(function() {
        jQuery(this).find("input[name=confirm]").val(id_event);
        jQuery(this).find("input[name=confirm_user]").val(id_user);
        jQuery(this).find("textarea").val("");
        jQuery(this).find("#modalEventAcceptUserName").html(name);
        jQuery(this).find("#modalEventAcceptTitle").html(title);
    });
    jQuery("#modalEventAccept").dialog({
        autoOpen: true,
        modal: true,
        title: 'Freigabe bestätigen',
        width: 600
    });
}

function UnlockDecline(id_event, title, id_user, name) {
    jQuery("#modalEventDecline").each(function() {
        jQuery(this).find("input[name=decline]").val(id_event);
        jQuery(this).find("input[name=decline_user]").val(id_user);
        jQuery(this).find("textarea").val("");
        jQuery(this).find("#modalEventDeclineUserName").html(name);
        jQuery(this).find("#modalEventDeclineTitle").html(title);
    });
    jQuery("#modalEventDecline").dialog({
        autoOpen: true,
        modal: true,
        title: 'Freigabe ablehnen',
        width: 600
    });
}

function UnlockDeclineSubmit(form) {
    jQuery.post(jQuery(form).attr("action"), jQuery(form).serialize(), function(result) {
        ReloadPage();
    });
}

function UnlockDeclineAllSubmit(form) {
    jQuery.post(jQuery(form).attr("action"), jQuery(form).serialize(), function(result) {
        ReloadPage();
    });
}

function UpdateMapIframe(iframe, form) {
		var iframeJs = jQuery(iframe);
		if (iframeJs.length > 0) {
			var iframeParams = jQuery(form).serialize().replace(/SEARCH\%5B(.+?)\%5D/g, "$1");
			jQuery.post("index.php", iframeParams+"&frame=iframe&page=googlemap&show=calendar_event", function(result) {
				var iframeDoc = iframeJs[0].contentDocument || iframeJs[0].contentWindow.document;
				iframeDoc.write(result);
				iframeDoc.close();
			});
		}
}

function callbackEventNotAvailable() {
    alert("Fehler!\nBitte loggen Sie sich im Frontend des ebiz-trader als Administrator ein um diese Anzeige zu betrachten.");
}


jQuery(function() {
	var stampFrom = jQuery("#STAMP_END_GT");
	var stampTo = jQuery("#STAMP_START_LT");
	stampFrom.datepicker({
		dateFormat: 'dd.mm.yy',
		maxDate: stampTo.val(),
		numberOfMonths: 2,
		onClose: function(dateStart) {
			stampTo.datepicker("option", "minDate", dateStart);
		}
	});
	stampTo.datepicker({
		dateFormat: 'dd.mm.yy',
		minDate: stampFrom.val(),
		numberOfMonths: 2,
		onClose: function(dateEnd) {
			stampFrom.datepicker("option", "maxDate", dateEnd);
		}
	});
	jQuery("a[data-page]").removeAttr("href").click(function() {
		var npage = jQuery(this).attr("data-page");
        ShowPage(npage);
		return false;
	});
	UpdateMapIframe(jQuery("#search_map"), jQuery("#form_search"));
});
</script>

<div id="modalEventAccept" style="display: none;">
    <form method="post" onsubmit="UnlockDeclineSubmit(this); return false;">
        <input type="hidden" name="page" value="{curpage}" />
        <input type="hidden" name="confirm" />
        <h3>
            Freigabe der Veranstaltung <b id="modalEventAcceptTitle">Anzeigentitel</b> besätigen
        </h3>
        <table width="100%">
            <tr>
                <th align="left" valign="top">Alle bestätigen:</th>
                <td>
                    <label class="checkbox">
                        <input type="checkbox" name="confirm_user" value="1" />
                        Alle unbestätigten Veranstaltungen des Benutzers <b id="modalEventAcceptUserName">Benutzername</b> bestätigen.
                    </label>
                </td>
            </tr>
            <tr>
                <td></td>
                <td align="right">
                    <input onclick="jQuery('#modalEventAccept').dialog('close'); return false;" type="button" value="Abbrechen" />
                    <input type="submit" value="Bestätigen" />
                </td>
            </tr>
        </table>
    </form>
</div>

<div id="modalEventDecline" style="display: none;">
    <form method="post" onsubmit="UnlockDeclineSubmit(this); return false;">
        <input type="hidden" name="page" value="{curpage}" />
        <input type="hidden" name="decline" />
        <h3>
            Freigabe der Veranstaltung <b id="modalEventDeclineTitle">Anzeigentitel</b> ablehnen
        </h3>
        <table width="100%">
            <tr>
                <th align="left" valign="top">Alle ablehnen:</th>
                <td>
                    <label class="checkbox">
                        <input type="checkbox" name="decline_user" value="1" />
                        Alle unbestätigten Veranstaltungen des Benutzers <b id="modalEventDeclineUserName">Benutzername</b> ablehnen.
                    </label>
                </td>
            </tr>
            <tr>
                <th align="left" valign="top">Begründung:</th>
                <td>
                    <textarea name="REASON" style="height: 200px; width: 95%;"></textarea>
                </td>
            </tr>
            <tr>
                <td></td>
                <td align="right">
                    <input onclick="jQuery('#modalEventDecline').dialog('close'); return false;" type="button" value="Abbrechen" />
                    <input type="submit" value="Ablehnen" />
                </td>
            </tr>
        </table>
    </form>
</div>

<div id="dialog" style="display: none;"></div>

<h1>Veranstaltungen</h1>
<p>Hier finden Sie eine Übersicht aller eingetragenen Veranstaltungen</p>

<table>
    <tr>
        <td>
<table cellspacing="0" cellpadding="0" class="liste" border="0">
	<tr>
		<th colspan="11" style="padding: 0;">
			<form id="form_search" action="index.php" method="POST">
				<input type="hidden" name="page" value="{curpage}" />
				<input type="hidden" name="npage" value="{npage}" />
				<table cellpadding="0" cellspacing="0" width="100%">
					<tr>
						<td><b>Titel:</b></td>
						<td>
							<input id="TITLE" name="SEARCH[TITLE]" type="text" placeholder="Titel durchsuchen..." value="{htm(SEARCH_TITLE)}" />
						</td>
						<td><b>Datum von:</b></td>
						<td>
							<input id="STAMP_END_GT" name="SEARCH[STAMP_END_GT]" type="text" placeholder="Von..." value="{todate(SEARCH_STAMP_END_GT)}" />
						</td>
						<td><b>Sortierung:</b></td>
						<td>
							<select id="SORT_BY" name="SEARCH[SORT]">
                    			<option value="STAMP_START,ASC" {if SORT_BY_STAMP_START_ASC}selected="selected"{endif}>Früheste zuerst</option>
                    			<option value="STAMP_START,DESC" {if SORT_BY_STAMP_START_DESC}selected="selected"{endif}>Späteste zuerst</option>
                    			<option value="COMMENTS,DESC" {if SORT_BY_COMMENTS_DESC}selected="selected"{endif}>Meiste Kommentare zuerst</option>
                    			<option value="COMMENTS,ASC" {if SORT_BY_COMMENTS_ASC}selected="selected"{endif}>Wenigste Kommentare zuerst</option>
                    			<option value="TITLE,ASC" {if SORT_BY_TITLE_ASC}selected="selected"{endif}>Alphabetisch aufsteigend</option>
                    			<option value="TITLE,DESC" {if SORT_BY_TITLE_DESC}selected="selected"{endif}>Alphabetisch absteigend</option>
							</select>
						</td>
					</tr>
					<tr>
						<td><b>Benutzer:</b></td>
						<td>
							<label>
								<input type="text" id="NAME_" name="NAME_" value="{htm(SEARCH_NAME_)}" onkeyup="jQuery('#FK_USER').val('');" placeholder="Erstellt von...">
								<input type="hidden" id="FK_USER" name="FK_USER" value="{int(SEARCH_FK_USER)}">
								<a href="#" onclick="popupfkt('users&amp;frompopup=1','850','500');">
									<img src="gfx/users_16.gif" width="16" height="16" alt="user suchen" border="0">
								</a>
							</label>
						</td>
						<td><b>Datum bis:</b></td>
						<td>
							<input id="STAMP_START_LT" name="SEARCH[STAMP_START_LT]" type="text" placeholder="Bis..." value="{todate(SEARCH_STAMP_START_LT)}" />
						</td>
						<td><b>Erstellt in:</b></td>
						<td>
							<select name="SEARCH[FK_REF_TYPE]">
								<option value="">----</option>
								<option value="club"{if FK_REF_TYPE_CLUB} selected="selected"{endif}>Gruppe</option>
								<option value="user"{if FK_REF_TYPE_USER} selected="selected"{endif}>Anbieter</option>
							</select>
							<input type="text" name="SEARCH[FK_REF]" value="{htm(SEARCH_FK_REF)}" size="20" placeholder="ID">
						</td>
					</tr>
					<tr>
                    {if MODERATE_EVENTS}
                        <td><b>Status:</b></td>
                        <td>
                            <select id="MODERATED" name="SEARCH[MODERATED]">
                                <option value=""{if !SEARCH_MODERATED && !SEARCH_MODERATED_0} selected="selected"{endif}>Alle anzeigen</option>
                                <option value="0" {if SEARCH_MODERATED_0} selected="selected"{endif}>Nicht freigeschaltet</option>
                                <option value="1" {if SEARCH_MODERATED_1} selected="selected"{endif}>Freigeschaltet</option>
                                <option value="2" {if SEARCH_MODERATED_2} selected="selected"{endif}>Abgelehnt</option>
                            </select>
                        </td>
						<td colspan="2"></td>
                    {else}
                        <td colspan="4"></td>
                    {endif}
						<td colspan="2" align="right">
							<a class="button" href="index.php?page=veranstaltung">Alle anzeigen</a>
							<input class="button" type="submit" name="search_submit" value="Suchen" />
						</td>
					</tr>
				</table>
			</form>
		</th>
	</tr>
    {if !SEARCH_RESULT && (npage < 2)}
    <tr>
        <td colspan="11">

            <iframe id="katframe" src="index.php?lang=de&frame=iframe&page=stats&show=veranstaltung&w=400&get_range=DAY" width="100%" height="200" frameborder="0"></iframe>

        </td>

    </tr>
    {endif}

	<tr>
		<th rowspan="2">
			Aktionen
		</th>
        {if MODERATE_EVENTS}
        <th rowspan="2" colspan="3">
            Freigabe
        </th>
        {endif}
		<th rowspan="2">
			Datum
		</th>
		<th rowspan="2">
			Veranstaltung
		</th>
		<th rowspan="2">
			Kategorie
		</th>
		<th rowspan="2">
			Kommentare
		</th>
		<th colspan="3" style="border-bottom: none; padding-bottom: 0;">
			Teilnehmer
		</th>
		<th rowspan="2">
			Erstellt von<br />
			Benutzer
		</th>
		<th rowspan="2">
			Erstellt in<br />
			Firma/Gruppe
		</th>
		<th rowspan="2">
			Ort
		</th>
	</tr>

	<tr>
		<th style="padding-top: 0;">
			<i class="icon icon-plus-sign" title="Zugesagt">+</i>
		</th>
		<th style="padding-top: 0;">
			<i class="icon icon-question-sign" title="Ungewiss">?</i>
		</th>
		<th style="padding-top: 0;">
			<i class="icon icon-minus-sign" title="Abgesagt">-</i>
		</th>
	</tr>
	{liste}
</table>
        </td>
        <td valign="top">
            <iframe id="search_map" src="about:blank" width="400" height="300" frameborder="0" style="border:0" allowfullscreen></iframe>
        </td>
    </tr>
</table>
<div>
	{pager}
</div>