<script type="text/javascript">
    jQuery(function() {
        jQuery("#invoicePaymentAdapterSelector").change(function() {
            var adapterId = jQuery(this).val();
            jQuery.ajax({
                url: '{uri_action(invoice,{INVOICE_ID_BILLING_INVOICE},setadapter)}',
                type: 'POST',
                data: { 'PAYMENT_ADAPTER': adapterId },
                success: function(response) {
                    location.reload();
                }
            });
        });

        var get_vars = [];

        document.location.search.replace(/\??(?:([^=]+)=([^&]*)&?)/g, function () {
            function decode(s) {
                return decodeURIComponent(s.split("+").join(" "));
            }
            get_vars[decode(arguments[1])] = decode(arguments[2]);
        });

        if ( get_vars["highlight"] != undefined ) {
            var ids = get_vars["highlight"].split("-");

            jQuery.each( ids, function(index, value) {
                var row =jQuery("table tr[data-invoice-billing-item='"+value+"']");
                row.css("background-color","#ffff99");
            });
        }

    })
</script>

<h1>
    View invoice
    <p class="lead">
        Invoice Nr. {INVOICE_ID_BILLING_INVOICE}
    {if INVOICE_STAMP_CORRECTION}
        <span class="text-danger">CORRECTION</span>
    {endif}
    {if INVOICE_STATUS==2}
        <span class="text-danger">CANCELED</span>
    {endif}
    </p>
</h1>

{if ERROR}
<div class="alert alert-danger">
An error has occurred on the transaction. Please try again or contact the site operator.
</div>
{endif}


{if INVOICE_ID_BILLING_INVOICE}
    <div class="row">
        <div class="col-xs-8">
            <strong>Invoice recipient</strong><br />
			{nl2br(INVOICE_ADDRESS)}
        </div>
        <div class="col-xs-4">
            <dl class="dl-table">
                <dt>Invoice Nr.:</dt>
                <dd>{INVOICE_ID_BILLING_INVOICE}</dd>

                <dt>Invoice date:</dt>
                <dd>
                {if INVOICE_STAMP_CORRECTION}
                    {todate(INVOICE_STAMP_CORRECTION)}
                    <span class="text-muted" style="text-decoration: line-through;">{todate(INVOICE_STAMP_CREATE)}</span>
                {else}
                    {todate(INVOICE_STAMP_CREATE)}
                {endif}
                </dd>

                <dt>Customer-Nr.:</dt>
                <dd>{INVOICE_USER_ID_USER}</dd>
            </dl>
        </div>
    </div>
    <br />


    <table class="mytable table table-bordered table-striped table-condensed">
        <tr>
            <th>Pos.</th>
            <th>Posten</th>
            <th class="text-right">Quantity</th>
            <th class="text-right">Unitprice<br/>(net)</th>
            <th class="text-right">VAT</th>
            <th class="text-right">Totalprice Gesamtpreis<br/>(gross)</th>
        </tr>
        {if INVOICE_ITEMS}
        {INVOICE_ITEMS}
        <tr>
            <th colspan="5" class="text-right">Total net:</th>
            <th class="text-right">{topreis_ex(INVOICE_TOTAL_PRICE_NET)} {CURRENCY_DEFAULT}</th>
        </tr>
        {INVOICE_TAXES}
        <tr>
            <th colspan="5" class="text-right">Total gross:</th>
            <th class="text-right">{topreis_ex(INVOICE_TOTAL_PRICE)} {CURRENCY_DEFAULT}</th>
        </tr>
        {else}
        <tr>
            <td colspan="6" align="center">
                <span class="error">Error! No items found</span>
            </td>
        </tr>
        {endif}
    </table>

	{if INVOICE_TAX_EXEMPT}
		<p>
			This is a matter of a taxfree intra-Community delivery.
			{if INVOICE_TAX_EXEMPT_USTID}<br>The VAT-ID of the beneficiary: {INVOICE_TAX_EXEMPT_USTID} {if INVOICE_TAX_EXEMPT_USTID_CHECKDATE}(checked on {todate(INVOICE_TAX_EXEMPT_USTID_CHECKDATE)}){endif}{endif}
		</p>
		<br><br>
	{endif}

    <div class="row">
        <div class="col-xs-6">
            <a href="{uri_action(invoice_print,{INVOICE_ID_BILLING_INVOICE})}" class="btn btn-default">
                <i class="glyphicon glyphicon-print"></i> Print invoice
            </a><br>
            <a href="{uri_action(invoice_cancel,{INVOICE_ID_BILLING_INVOICE},invoice)}" class="btn btn-default">
                <i class="fa fa-eraser"></i> Cancel invoice / items
            </a>

        </div>
        <div class="col-xs-6">
            <div class="pull-right">
                <table cellspacing="0">
                    <tr>
                        <td style="width: 150px;"><strong>Conditions of payment:</strong></td>
                        <td>Conditions of payment due {todate(INVOICE_STAMP_DUE)}</td>
                    </tr>
                    <tr>
                        <td><strong>Payment method:</strong></td>
                        <td>
                            {if INVALID_PAYMENT_ADAPTER}
                                Please contact the site operator
                            {else}
                                {INVOICE_PAYMENT_ADAPTER_NAME}
                            {endif}
                        </td>
                    </tr>
                </table>
            </div>
        </div>
    </div>
    <div class="row">
        <div class="col-md-12">
            <div class="design-content-box design-icon-legend" style="margin-top: 10px;">
                <span>Note : </span>
                <span class="btn btn-default" style="color: blue;">
				<strong>!</strong>
			</span> = Include cancel requests
            </div>
        </div>
    </div>

	<br>



    <br />

	{if INVOICE_STATUS == 0}
    <h3>Incoming payments</h3>
    <table class="mytable table table-bordered table-striped table-condensed">
        <tr>
            <th>Nr.</th>
            <th>Date</th>
            <th>Description</th>
            <th class="text-right">Amount</th>
        </tr>
        {if TRANSACTIONS}
            {TRANSACTIONS}
        {else}
            <tr>
                <td colspan="4" align="center">
                    <span class="text-error">There are no incoming payments available</span>
                </td>
            </tr>
        {endif}
		{if INVOICE_STATUS == 0}
        <tr>
            <th colspan="3" class="text-right">already paid:</th>
            <th class="text-right">{topreis_ex(INVOICE_PAID_PRICE)} {CURRENCY_DEFAULT}</th>
        </tr>
		<tr>
            <th colspan="3" class="text-right">remaining:</th>
            <th class="text-right">{topreis_ex(INVOICE_REMAINING_PRICE)} {CURRENCY_DEFAULT}</th>
        </tr>
		{endif}
    </table>
	{endif}


    <div class="design-content-box form-inline">
		{if PAYMENT_ADAPTER_SUCCESS_OUTPUT || PAYMENT_ADAPTER_PENDING_OUTPUT || PAYMENT_ADAPTER_CANCEL_OUTPUT}
            {if PAYMENT_ADAPTER_CANCEL_OUTPUT}{PAYMENT_ADAPTER_CANCEL_OUTPUT}{endif}
            {if PAYMENT_ADAPTER_PENDING_OUTPUT}{PAYMENT_ADAPTER_PENDING_OUTPUT}{endif}
    		{if PAYMENT_ADAPTER_SUCCESS_OUTPUT}{PAYMENT_ADAPTER_SUCCESS_OUTPUT}{endif}
		{else}
			{if INVOICE_STATUS == 0}
				<h3 class="top">Select payment method</h3>

				<p>Select a payment method from the list, to pay the invoice.</p>

				<select class="form-control" name="PAYMENT_ADAPTER" id="invoicePaymentAdapterSelector">
					{PAYMENT_ADAPTER}
				</select>

				{if PAYMENT_ADAPTER_PREPARE_OUTPUT}
					{PAYMENT_ADAPTER_PREPARE_OUTPUT}
				{endif}
			{endif}
			{if INVOICE_STATUS == 1}
				<p class="text-success"><strong>The invoice was paid</strong></p>
			{endif}

			{if INVOICE_STATUS == 2}
				<p class="text-warning"><strong>The invoice was cancelled</strong></p>
			{endif}
		{endif}
    </div>

{endif}
