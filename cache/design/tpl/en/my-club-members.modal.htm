<script type="text/javascript">

function addUser() {
	jQuery('#modal_club_member_add .step1').removeClass('hidden');
	jQuery('#modal_club_member_add .step2a').addClass('hidden');
	jQuery('#modal_club_member_add .step2b').addClass('hidden');

	jQuery('#modal_club_member_add .alert-danger').addClass('hidden');

	//jQuery('#modal_club_member_add .btn-cancel').removeClass('hidden');
	jQuery('#modal_club_member_add .btn-back').addClass('hidden');
	jQuery('#modal_club_member_add .btn-primary').addClass('disabled');
	jQuery('#modal_club_member_add').modal();
}

function addUserRegistered() {
	jQuery('#modal_club_member_add .step1').addClass('hidden');
	jQuery('#modal_club_member_add .step2a').removeClass('hidden');
	jQuery('#modal_club_member_add .step2b').addClass('hidden');

	//jQuery('#modal_club_member_add .btn-cancel').addClass('hidden');
	jQuery('#modal_club_member_add .btn-back').removeClass('hidden');
	jQuery('#modal_club_member_add .btn-primary').removeClass('disabled');
}

function addUserNew() {
	jQuery('#modal_club_member_add .step1').addClass('hidden');
	jQuery('#modal_club_member_add .step2a').addClass('hidden');
	jQuery('#modal_club_member_add .step2b').removeClass('hidden');

	//jQuery('#modal_club_member_add .btn-cancel').addClass('hidden');
	jQuery('#modal_club_member_add .btn-back').removeClass('hidden');
	jQuery('#modal_club_member_add .btn-primary').removeClass('disabled');
}

function addUserSubmit() {
    if (jQuery('#adduser_submit').hasClass("disabled")) {
        return false;
    }

	var is_known = !jQuery('#modal_club_member_add_known').hasClass("hidden");
	if (is_known) {
		addUserRegisteredSubmit( jQuery("#modal_club_member_add_known").serialize() );
	} else {
		addUserNewSubmit( jQuery("#modal_club_member_add_new").serialize() );
	}
}

function addUserRegisteredSubmit(parameters) {
    jQuery.ajax({
        url: "{uri_baseurl(/index.php)}?page=my-club-members&ID_CLUB={CLUB_ID_CLUB}&do=add_known&"+parameters,
        dataType: 'json',
        success: function(result) {
			if (result.success) {
				jQuery('#modal_club_member_add').modal("hide");
				window.location.href = '{uri_action(my-club-members,{CLUB_ID_CLUB},added)}';
			} else {
				jQuery('#modal_club_member_add .alert-danger').removeClass('hidden');
				jQuery('#modal_club_member_add .alert-danger ul').html(result.errors);
			}
        }
    });
}

function addUserNewSubmit(parameters) {
    jQuery.ajax({
        url: "{uri_baseurl(/index.php)}?page=my-club-members&ID_CLUB={CLUB_ID_CLUB}&do=add_new&"+parameters,
        dataType: 'json',
        success: function(result) {
			if (result.success) {
				jQuery('#modal_club_member_add').modal("hide");
				window.location.href = '{uri_action(my-club-members,{CLUB_ID_CLUB},added)}';
			} else {
				jQuery('#modal_club_member_add .alert-danger').removeClass('hidden');
				jQuery('#modal_club_member_add .alert-danger ul').html(result.errors);
			}
        }
    });
}

</script>
<div id="modal_club_member_add" class="modal fade">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
				<h3>Invite member</h3>
			</div>
			<div class="modal-body">
				<div class="alert alert-danger hidden">
					<h3>Error!</h3>
					<ul></ul>
				</div>
				<div class="step1 hidden">
					<p>
						Is the person you want to invite already a member of the marketplace?
					</p>
					<span class="btn-group text-right">
						<a class="btn btn-default" onclick="addUserRegistered();">Yes</a>
						<a class="btn btn-default" onclick="addUserNew();">No</a>
					</span>
				</div>
				<form id="modal_club_member_add_known" class="step2a form-horizontal">
					<div class="control-group">
						<label class="control-label" for="inputUsername">Username</label>
						<div class="controls">
							<input class="form-control" type="text" id="inputUsername" name="USERNAME" placeholder="The username of the person" />
						</div>
					</div>
					<div class="control-group">
						<label class="control-label" for="inputMessage">Message</label>
						<div class="controls">
							<textarea class="form-control" id="inputMessage" name="MESSAGE" placeholder="Your comment on the invite"></textarea>
						</div>
					</div>
				</form>
				<form id="modal_club_member_add_new" class="step2b form-horizontal">
					<div class="control-group">
						<label class="control-label" for="inputName">Name</label>
						<div class="controls">
							<input class="form-control" type="text" id="inputName" name="NAME" placeholder="e.g.: John Doe" />
						</div>
					</div>
					<div class="control-group">
						<label class="control-label" for="inputEmail">E-Mail</label>
						<div class="controls">
							<input class="form-control" type="text" id="inputEmail" name="EMAIL" placeholder="e.g.: John.Doe@yahoo.com" />
						</div>
					</div>
					<div class="control-group">
						<label class="control-label" for="inputMessage">Message</label>
						<div class="controls">
							<textarea class="form-control" id="inputMessage" name="MESSAGE" placeholder="Your comment on the invite"></textarea>
						</div>
					</div>
				</form>
			</div>
			<div class="modal-footer">
				<a href="#cancel" class="btn btn-default btn-cancel" data-dismiss="modal" aria-hidden="true">Cancel</a>
				<a href="#back" class="btn btn-default btn-back" onclick="addUser(); return false;">Back</a>
				<a href="#submit" class="btn btn-primary disabled" onclick="addUserSubmit(); return false;" id="adduser_submit">Send invite</a>
			</div>
		</div>
	</div>
</div>