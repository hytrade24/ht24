<script type="text/javascript">
	function updateCartPaymentAdapter(el) {
		var value = jQuery(el).val();
		jQuery.ajax({
			url: 'index.php?page=cart&frame=ajax',
			'type': 'POST',
			'data': { 'DO': 'SETCARTPAYMENTADAPTER', 'CART_PAYMENT_ADAPTER': value },
			'success': function(result) {
				jQuery("select[name*=payment_adapter]").each(function(index, inputSelect) {
					var isAvailable = jQuery(inputSelect).find("option[value="+value+"]").length;
					if (isAvailable > 0) {
						jQuery(inputSelect).val(value);
					}
				});
			}
		});
	}
	
	function updateCartItemPaymentAdapter(el, idArticle, idVariant) {
		var value = jQuery(el).val();
		jQuery.ajax({
			url: 'index.php?page=cart&frame=ajax',
			'type': 'POST',
			'data': { 'DO': 'SETPAYMENTADAPTER', 'ID_AD': idArticle, 'ID_VARIANT': idVariant, 'CART_PAYMENT_ADAPTER': value },
			'success': function(result) {
				// Nothing yet
			}
		});
	}

  function removeArticleFromCart(adId, adVariantId) {
    if(confirm("Do you really want to delete this product from your shopping cart ?")) {
      CartRemoveArticle(adId, adVariantId, function() {
          document.location.reload();
      });
    }
  }
	
	function cartUpdateList() {
    jQuery(".design-cart-list-loading").show();
		jQuery.post("{uri_action(cart)}", "ajax=list&"+jQuery("form.design-user-cart").serialize(), function(result) {
			jQuery(".design-cart-list").html(result);
		});
	}

{if !ID_USER && liste && !updated}
    jQuery(function () {
        ShowContentDialog(
            jQuery("#prompt").html(), 
            "{if SETTINGS_BUYING_UNREGISTERED}Continue purchase without logging in{else}Please login to proceed{endif}", 
            800, "auto", 
            {
                'beforeclose': function () {
                    {if !SETTINGS_BUYING_UNREGISTERED}
                        location.href = '{uri_action(cart)}';
                        return false;
                    {endif}
                }
            }
        );
    });
{endif}
</script>

<h1>Shopping cart</h1>
<p class="lead">
    Products in your shopping cart
</p>

<script type="text/html" id="prompt">
<div class="design-user-cart">
  <div class="row design-user-cart-register-split">
    <div>
      {if SETTINGS_BUYING_UNREGISTERED}
        <h4>Continue without an account?</h4>

        <p>
          If you are new on our marketplace and you want to proceed to your order without an account, click on the following button:
        </p>

        <button type="button" data-dismiss="modal" class="btn btn-default" aria-hidden="true">
          Continue purchase without an account
        </button>

        <br>
        <br>
      {endif}

      <h4>Register on the marketplace?</h4>

      <p>
        Do you want to use all advantages on our marketplace ? Then register now with your personal
							account.

      </p>

      <a href="{uri_action(register)}" class="btn btn-default">Register on the marketplace</a>

    </div>
    <div>
      <div class="design-content-box">
        <form method="post" target="_top" action="{uri_baseurl_ssl(/login.php)}">
          <input type="hidden" name="dummy" value="" />
          <input type="hidden" name="redirect" value="{uri_action({curpage})}" />
          <input type="hidden" name="forward" value="login" />

          <h4>Do you have an account already?</h4>

          <p>
            If you have an existing login on our marketplace already, you can login here and
								continue your purchase on your account.

          </p>

          <div class="form-group">
            <label class="control-label">Username:</label>
            <input class="form-control" type="text" name="user" id="loginname" maxlength="30" value="{htm(user)}" />
          </div>

          <div class="form-group">
            <label class="control-label">Password:</label>
            <input class="form-control" type="password" name="pass" id="loginpass" maxlength="64" />
          </div>


          <div class="checkbox">
            <label>
              <input type="checkbox" name="stay" value="1">
              Stay logged in?
            </label>
          </div>

          <p>
            <input name="submit" type="submit" class="btn btn-default" value="Login" />
          </p>
          <p>
            <a href="{uri_action(login,lostpassword)}" title="Request password">
              Forgot password?
            </a>
          </p>

        </form>
      </div>
    </div>
  </div>
</div>
</script>

<form action="{uri_action(cart)}" method="POST" class="design-user-cart">
    <input type="hidden" name="DO" value="SET_ARTICLE_DETAILS">

    <div class="design-content-box">
    {if err_address || err_user_create || err_buying_unregistered_not_allowed}
        <div class="alert alert-danger">
            <button type="button" class="close" data-dismiss="alert">&times;</button>
		    		<strong>An error has occurred!</strong>

            <ul>
				    {if err_address}
					      <li>Bitte geben Sie ihre vollständige Adresse an um die Bestellung abzuschließen.</li>
            {endif}
            {if err_address_required}
                <li>Sie müssen alle Pflichtfelder ausfüllen.</li>
            {endif}
            {if err_address_name_or_company}
                <li>Sie müssen entweder Vor- und Nachname oder einen Firmennamen angeben.</li>
            {endif}
				    {if err_user_create}
					      <li>A user with this E-Mail address does already exist</li>
				    {endif}
				    {if err_buying_unregistered_not_allowed}
					      <li>A purchase without an account is not possible. Please register on our marketplace</li>
				    {endif}
            </ul>
        </div>
    {endif}
    {if ID_USER || SETTINGS_BUYING_UNREGISTERED}
				<div class="row design-user-cart-address-split">
            <div>
                <h3>Your billing address</h3>
                {if ID_USER > 0}
						        {subtpl(tpl/{SYS_TPL_LANG}/user_invoice.htm,*)}
					      {else}
						        {subtpl(tpl/{SYS_TPL_LANG}/user_invoice_guest.htm,*)}
					      {endif}
					  </div>
            <div>
						    <h3>Your delivery address</h3>
					      {if ID_USER > 0}
						        {subtpl(tpl/{SYS_TPL_LANG}/user_versand.htm,*)}
					      {else}
						        {subtpl(tpl/{SYS_TPL_LANG}/user_versand_guest.htm,*)}
					      {endif}
					  </div>
				</div>
    {endif}
        <p>
        You order goods from various seller, who each have their own GTC  and withdrawal conditions.
                    <br><br>
                    <strong>
                        The sale occur under the condition of availability of services
                        Every purchase is legally binding and can not be canceled!
                    </strong>

        </p>
		</div>
    

    <p class="pull-right">
        {if liste}
            <button type="submit" name="DO" value="CONTINUE" class="btn btn-success">
                Proceed to checkout
            </button>
        {endif}
    </p>
    <div class="clearfix"></div>

    {if cart_payment_adapter}
    <br />
    <div class="cart-payment-adapter design-content-box form-inline">
        <div class="form-group">
            <label class="control-label">
                Your prefered payment method:
            </label>
            <select class="form-control" name="CART_PAYMENT_ADAPTER" onchange="updateCartPaymentAdapter(this)">
                {cart_payment_adapter}
            </select>
        </div>
        <br />
        <span class="text-muted">
            Please consider that, on some circumstances, not every payment method is supported by every seller.
        </span>
    </div>
    {endif}
    
    <div class="design-cart-list">
			{subtpl(tpl/{SYS_TPL_LANG}/cart.list.htm,*)}
    </div>

		{PLUGIN_HTML}
  
	<br>
	<a href="{uri_action(marktplatz)}" class="btn btn-default">Continue shopping</a>

    {if liste}
        <button type="submit" name="DO" value="CONTINUE" class="btn btn-success pull-right">
            Proceed to checkout
        </button>
    {endif}

</form>