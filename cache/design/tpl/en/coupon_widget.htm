<script>
	function Coupon_SubmitCode() {
		var code = jQuery("[name='COUPON_CODE']").val().trim();

		if(code.length > 0) {

			jQuery.ajax({
				url: ebiz_trader_baseurl + 'index.php?page=invoices&DO=COUPON_SUBMIT',
				data: {
					COUPON_WIDGET_TARGET_TYPE: '{COUPON_WIDGET_TARGET_TYPE}',
					COUPON_WIDGET_TARGETS: '{base64encode({COUPON_WIDGET_TARGETS_JSON})}',
					COUPON_CODE: code
				},
				type: 'post',
				dataType: 'json',
				success: function (result) {
					jQuery(".coupon-widget-error").html('');
					if(result.success) {

						jQuery(".coupon-widget-input").after("<p class='text-success'>The coupon was activated successfully. Continue your order.</p>");
						jQuery(".coupon-widget-input").after("<inut type='hidden' name='COUPON_CODE_USAGE' value='"+result.couponUsageId+"'>");
						jQuery(".coupon-widget-input, .coupon-widget-input").detach();

					} else {
						jQuery(".coupon-widget-error").html(result.message);
					}
				}
			})
		} else {
			jQuery(".coupon-widget-error").html("No coupon code was entered");
		}
	}

	jQuery(function() {
		jQuery("[name='COUPON_CODE_USAGE']").change(function() {
			if(jQuery(this).val() == '') {
				jQuery(".coupon-widget-input input, .coupon-widget-input button").attr('disabled', false);
			} else {
				jQuery(".coupon-widget-input input, .coupon-widget-input button").attr('disabled', true);
			}
		})
	})

</script>

<!-- Gutscheine -->
<div class="design-content-box coupon-widget">
	<p><strong>Do you have a coupon code?</strong></p>


	<div class="coupon-widget-input form-inline">
		<input class="form-control" type="text" name="COUPON_CODE" value="{htm(COUPON_CODE)}" placeholder="Enter coupon code">
		<button onclick="Coupon_SubmitCode(); return false;" class="btn">Redeem a coupon</button>
	</div>
	<div class="coupon-widget-error text-error"></div>

	{if coupon_available}
		<div class="coupon-widget-choose">
		<p>- or choose a not yet redeemed coupon -</p>

		<div class="radio">
			<label>
				<input type="radio" value="" checked name="COUPON_CODE_USAGE">
				<em>Do not use a coupon</em>
			</label>
		</div>
		{coupon_available}
		</div>
	{endif}
</div>
<!-- Ende Gutscheine -->