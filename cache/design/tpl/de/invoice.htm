<script type="text/javascript">
    jQuery(function() {
        jQuery("#invoicePaymentAdapterSelector").change(function() {
            var adapterId = jQuery(this).val();
            jQuery.ajax({
                url: '{uri_action(invoice,{INVOICE_ID_BILLING_INVOICE},setadapter)}',
                type: 'POST',
                data: { 'PAYMENT_ADAPTER': adapterId },
                success: function(response) {
                    location.reload();
                }
            });
        });

        var get_vars = [];

        document.location.search.replace(/\??(?:([^=]+)=([^&]*)&?)/g, function () {
            function decode(s) {
                return decodeURIComponent(s.split("+").join(" "));
            }
            get_vars[decode(arguments[1])] = decode(arguments[2]);
        });

        if ( get_vars["highlight"] != undefined ) {
            var ids = get_vars["highlight"].split("-");

            jQuery.each( ids, function(index, value) {
                var row =jQuery("table tr[data-invoice-billing-item='"+value+"']");
                row.css("background-color","#ffff99");
            });
        }

    })
</script>

<h1>
    Rechnung ansehen
    <p class="lead">
        Rechnung Nr. {INVOICE_ID_BILLING_INVOICE}
    {if INVOICE_STAMP_CORRECTION}
        <span class="text-danger">KORREKTUR</span>
    {endif}
    {if INVOICE_STATUS==2}
        <span class="text-danger">STORNIERT</span>
    {endif}
    </p>
</h1>

{if ERROR}
<div class="alert alert-danger">
Bei der Transaktion ist ein Fehler aufgetreten. Bitte versuchen Sie es erneut oder kontaktieren Sie den Seitenbetreiber.
</div>
{endif}


{if INVOICE_ID_BILLING_INVOICE}
    <div class="row">
        <div class="col-xs-8">
            <strong>Rechnungsempfänger</strong><br />
			{nl2br(INVOICE_ADDRESS)}
        </div>
        <div class="col-xs-4">
            <dl class="dl-table">
                <dt>Rechnung Nr.:</dt>
                <dd>{INVOICE_ID_BILLING_INVOICE}</dd>

                <dt>Rechnungsdatum:</dt>
                <dd>
                {if INVOICE_STAMP_CORRECTION}
                    {todate(INVOICE_STAMP_CORRECTION)}
                    <span class="text-muted" style="text-decoration: line-through;">{todate(INVOICE_STAMP_CREATE)}</span>
                {else}
                    {todate(INVOICE_STAMP_CREATE)}
                {endif}
                </dd>

                <dt>Kunden Nr.:</dt>
                <dd>{INVOICE_USER_ID_USER}</dd>
            </dl>
        </div>
    </div>
    <br />


    <table class="mytable table table-bordered table-striped table-condensed">
        <tr>
            <th>Pos.</th>
            <th>Posten</th>
            <th class="text-right">Menge</th>
            <th class="text-right">Einzelpreis<br/>(netto)</th>
            <th class="text-right">MwSt.</th>
            <th class="text-right">Gesamtpreis<br/>(brutto)</th>
        </tr>
        {if INVOICE_ITEMS}
        {INVOICE_ITEMS}
        <tr>
            <th colspan="5" class="text-right">Gesamt Netto:</th>
            <th class="text-right">{topreis_ex(INVOICE_TOTAL_PRICE_NET)} {CURRENCY_DEFAULT}</th>
        </tr>
        {INVOICE_TAXES}
        <tr>
            <th colspan="5" class="text-right">Gesamt Brutto:</th>
            <th class="text-right">{topreis_ex(INVOICE_TOTAL_PRICE)} {CURRENCY_DEFAULT}</th>
        </tr>
        {else}
        <tr>
            <td colspan="6" align="center">
                <span class="error">Fehler! Keine Rechnungsposten gefunden</span>
            </td>
        </tr>
        {endif}
    </table>

	{if INVOICE_TAX_EXEMPT}
		<p>
			Es handelt sich hierbei um eine steuerfreie innergemeinschaftliche Lieferung.
			{if INVOICE_TAX_EXEMPT_USTID}<br>Die USt.-Id des Leistungsempfängers: {INVOICE_TAX_EXEMPT_USTID} {if INVOICE_TAX_EXEMPT_USTID_CHECKDATE}(geprüft am {todate(INVOICE_TAX_EXEMPT_USTID_CHECKDATE)}){endif}{endif}
		</p>
		<br><br>
	{endif}

    <div class="row">
        <div class="col-xs-6">
            <a href="{uri_action(invoice_print,{INVOICE_ID_BILLING_INVOICE})}" class="btn btn-default">
                <i class="glyphicon glyphicon-print"></i> Rechnung drucken
            </a><br>
            <a href="{uri_action(invoice_cancel,{INVOICE_ID_BILLING_INVOICE},invoice)}" class="btn btn-default">
                <i class="fa fa-eraser"></i> Rechnungen oder Position stornieren
            </a>

        </div>
        <div class="col-xs-6">
            <div class="pull-right">
                <table cellspacing="0">
                    <tr>
                        <td style="width: 150px;"><strong>Zahlungsbedingungen:</strong></td>
                        <td>Zahlbar bis {todate(INVOICE_STAMP_DUE)}</td>
                    </tr>
                    <tr>
                        <td><strong>Zahlungsart:</strong></td>
                        <td>
                            {if INVALID_PAYMENT_ADAPTER}
                                Bitte wenden Sie sich an den Seitenbetreiber
                            {else}
                                {INVOICE_PAYMENT_ADAPTER_NAME}
                            {endif}
                        </td>
                    </tr>
                </table>
            </div>
        </div>
    </div>
    <div class="row">
        <div class="col-md-12">
            <div class="design-content-box design-icon-legend" style="margin-top: 10px;">
                <span>Note : </span>
                <span class="btn btn-default" style="color: blue;">
				<strong>!</strong>
			</span> = Beinhaltet Strornoanfragen
            </div>
        </div>
    </div>

	<br>



    <br />

	{if INVOICE_STATUS == 0}
    <h3>Zahlungseingänge</h3>
    <table class="mytable table table-bordered table-striped table-condensed">
        <tr>
            <th>Nr.</th>
            <th>Datum</th>
            <th>Beschreibung</th>
            <th class="text-right">Betrag</th>
        </tr>
        {if TRANSACTIONS}
            {TRANSACTIONS}
        {else}
            <tr>
                <td colspan="4" align="center">
                    <span class="text-error">Es sind bisher keine Zahlungseingänge vorhanden</span>
                </td>
            </tr>
        {endif}
		{if INVOICE_STATUS == 0}
        <tr>
            <th colspan="3" class="text-right">bereits bezahlt:</th>
            <th class="text-right">{topreis_ex(INVOICE_PAID_PRICE)} {CURRENCY_DEFAULT}</th>
        </tr>
		<tr>
            <th colspan="3" class="text-right">noch offen:</th>
            <th class="text-right">{topreis_ex(INVOICE_REMAINING_PRICE)} {CURRENCY_DEFAULT}</th>
        </tr>
		{endif}
    </table>
	{endif}


    <div class="design-content-box form-inline">
		{if PAYMENT_ADAPTER_SUCCESS_OUTPUT || PAYMENT_ADAPTER_PENDING_OUTPUT || PAYMENT_ADAPTER_CANCEL_OUTPUT}
            {if PAYMENT_ADAPTER_CANCEL_OUTPUT}{PAYMENT_ADAPTER_CANCEL_OUTPUT}{endif}
            {if PAYMENT_ADAPTER_PENDING_OUTPUT}{PAYMENT_ADAPTER_PENDING_OUTPUT}{endif}
    		{if PAYMENT_ADAPTER_SUCCESS_OUTPUT}{PAYMENT_ADAPTER_SUCCESS_OUTPUT}{endif}
		{else}
			{if INVOICE_STATUS == 0}
				<h3 class="top">Zahlungsweise auswählen</h3>

				<p>Bitte wählen Sie aus der Liste die gewünschte Zahlungsart aus, um die Rechnung zu begeleichen.</p>

				<select class="form-control" name="PAYMENT_ADAPTER" id="invoicePaymentAdapterSelector">
					{PAYMENT_ADAPTER}
				</select>

				{if PAYMENT_ADAPTER_PREPARE_OUTPUT}
					{PAYMENT_ADAPTER_PREPARE_OUTPUT}
				{endif}
			{endif}
			{if INVOICE_STATUS == 1}
				<p class="text-success"><strong>Die Rechnung wurde vollständig bezahlt</strong></p>
			{endif}

			{if INVOICE_STATUS == 2}
				<p class="text-warning"><strong>Die Rechnung wurde storniert</strong></p>
			{endif}
		{endif}
    </div>

{endif}
